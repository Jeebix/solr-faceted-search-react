// index.js
import React from "react";
import ReactDOM from "react-dom";
import {
    SolrFacetedSearch,
    SolrClient
} from "solr-faceted-search-react";


// The search fields and filterable facets you want
const fields = [
    // { label: "Pays (au sens commercial)", field: "asso_country_s", type: "list-facet",
    //     facet_name: "byCommercialCountry", multi_select: false,
    //     facetSort: "count", grid: "col-sm-4",
    //     group: "geo", icon_class: "fa-globe fa-2x" },
    // { label: "Pays (au sens postal)", field: "postal_country_s", type: "list-facet",
    //     facet_name: "byCountry", multi_select: false,
    //     facetSort: "count", grid: "col-sm-4",
    //         group: "geo", icon_class: "fa-globe fa-2x" },
    // { label: "Etat marketing", field: "etat_marketing_s", type: "list-facet",
    //             facet_name: "byEtatMarketing", multi_select: false, invert: false,
    //             facetSort: "count", grid: "col-sm-4",
    //             group: "marketing", icon_class: "fa-address-card fa-2x" },
    // { label: "", field: "groupe_type_parent_s", type: "list-facet",
    //     facet_name: "byRegroupementParent", multi_select: true,
    //     facetSort: "count", grid: "col-sm-6",
    //     group: "type", icon_class: "fa-home fa-2x" },
    // { label: "par type", field: "type_parent_s", type: "list-facet",
    //     facet_name: "byTypeParent", multi_select: true,
    //     facetSort: "count", grid: "col-sm-6",
    //     group: "type", icon_class: "fa-home fa-2x" },
    // { label: "", field: "groupe_type_asso_s", type: "list-facet",
    //     facet_name: "byRegroupementAsso", multi_select: true,
    //     facetSort: "count", grid: "col-sm-6",
    //     group: "type", icon_class: "fa-users fa-2x" },
    // { label: "par type", field: "type_asso_s", type: "list-facet",
    //     facet_name: "byTypeAsso", multi_select: true,
    //     facetSort: "count", grid: "col-sm-6",
    //     group: "type", icon_class: "fa-users fa-2x" },
    // { label: "Zone", field: "zone_scolaire_s", type: "list-facet",
    //     facet_name: "byZone", multi_select: true, invert: false,
    //     facetSort: "count", grid: "col-sm-3",
    //     group: "geo", icon_class: "fa-graduation-cap fa-2x" },
    // { label: "Territoire", field: "territoire_s", type: "list-facet",
    //                 facet_name: "byTerritoire", multi_select: true, invert: false,
    //                 facetSort: "count", grid: "col-sm-3",
    //                 group: "geo", icon_class: "fa-globe fa-2x" },
    // { label: "Region", field: "region_s", type: "list-facet",
    //     facet_name: "byRegion", multi_select: true, invert: false,
    //     facetSort: "count", grid: "col-sm-3",
    //     group: "geo", icon_class: "fa-globe fa-2x" },
    // { label: "Departement", field: "departement_s", type: "list-facet",
    //     facet_name: "byDept", multi_select: true, invert: false,
    //     facetSort: "count", grid: "col-sm-3",
    //     group: "geo", icon_class: "fa-globe fa-2x" },
    // { label: "Kits sans suite", field: "kits_sans_suite_ss", type: "list-facet",
    //     facet_name: "bySuite", multi_select: false,
    //     facetSort: "count", grid: "col-sm-4",
    //     group: "marketing", icon_class: "fa-users fa-2x" },
    // { label: "Gammes", field: "gamme", type: "list-facet",
    //     facet_name: "byNestedGammes", multi_select: false, invert: false,
    //     nested: true, child: "object_type_s:contact",
    //     facetSort: "index",grid:"col-sm-4",
    //     group:"marketing",icon_class:"fa-globe fa-2x"},
    // { label: "Historique", field: ['enseigne', 'type', 'campagne'], type: "matrix-facet",
    //     facet_name: "byHisto", multi_select: false,
    //     facetSort: "count", grid: "col-sm-8",
    //     group: "hist", icon_class: "fa-users fa-2x" },
    // { label: "Chiffre", field: "ca_periode_i", type: "range-facet",
    //     facet_name: "byCA", multi_select: true, invert: false,
    //     facetSort: "count", grid: "col-sm-4",
    //     group: "marketing", icon_class: "fa-eur fa-2x" }
    {
        label: "Pays (au sens commercial)", field: "asso_country_s", type: "list-facet",
        facet_name: "byCommercialCountry", multi_select: false,
        facetSort: "count", grid: "col-md-4",
        group: "geo", icon_class: "fa-globe fa-2x"
    },
    {
        label: "Pays (au sens postal)", field: "postal_country_s", type: "list-facet",
        facet_name: "byCountry", multi_select: false,
        facetSort: "count", grid: "col-md-4",
        group: "geo", icon_class: "fa-globe fa-2x"
    },
    {
        label: "Territoire", field: "territoire_s", type: "list-facet",
        facet_name: "byTerritoire", multi_select: true, invert: false,
        facetSort: "count", grid: "col-md-4",
        group: "geo", icon_class: "fa-globe fa-2x"
    },
    {
        label: "Regroupement parent", field: "groupe_type_parent_s", type: "list-facet",
        facet_name: "byRegroupementParent", multi_select: true,
        facetSort: "count", grid: "col-md-4",
        group: "type", icon_class: "fa-home fa-2x",
        tooltip: "Pour sélectionner les établissements ainsi que les associations présentes au sein de ces établissements."
    },
    {
        label: "Type parent", field: "type_parent_s", type: "list-facet",
        facet_name: "byTypeParent", multi_select: true,
        facetSort: "count", grid: "col-md-4",
        group: "type", icon_class: "fa-home fa-2x"
    },
    {
        label: "Regroupement asso", field: "groupe_type_asso_s", type: "list-facet",
        facet_name: "byRegroupementAsso", multi_select: true,
        facetSort: "count", grid: "col-md-4",
        group: "type", icon_class: "fa-users fa-2x",
        tooltip: "Pour sélectionner directement et uniquement les associations présentes dans les établissements, mais pas les établissements eux-mêmes."
    },
    {
        label: "Type asso", field: "type_asso_s", type: "list-facet",
        facet_name: "byTypeAsso", multi_select: true,
        facetSort: "count", grid: "col-md-4",
        group: "type", icon_class: "fa-users fa-2x"
    },
    {
        label: "Zone scolaire", field: "zone_scolaire_s", type: "list-facet",
        facet_name: "byZone", multi_select: true, invert: false,
        facetSort: "count", grid: "col-md-4",
        group: "geo", icon_class: "fa-graduation-cap fa-2x"
    },
    {
        label: "Région", field: "region_s", type: "list-facet",
        facet_name: "byRegion", multi_select: true, invert: false,
        facetSort: "count", grid: "col-md-4",
        group: "geo", icon_class: "fa-globe fa-2x"
    },
    {
        label: "Département", field: "departement_s", type: "list-facet",
        facet_name: "byDept", multi_select: true, invert: false,
        facetSort: "count", grid: "col-md-4",
        group: "geo", icon_class: "fa-globe fa-2x"
    },
    {
        label: "Etat marketing", field: "etat_marketing_s", type: "list-facet",
        facet_name: "byEtatMarketing", multi_select: false, invert: false,
        facetSort: "count", grid: "col-md-4",
        group: "marketing", icon_class: "fa-address-card fa-2x"
    },
    {
        label: "Période d'inactivité", field: "age_inactivite_s", type: "list-facet",
        facet_name: "byAgeInactivite", multi_select: true, invert: false,
        facetSort: "count", grid: "col-md-4",
        group: "marketing", icon_class: "fa-history fa-2x"
    },
    {
        label: "Kits sans suite", field: "kits_sans_suite_ss", type: "list-facet",
        facet_name: "bySuite", multi_select: false,
        facetSort: "count", grid: "col-md-4",
        group: "marketing", icon_class: "fa-question fa-2x"
    },
    {
        label: "Gammes", field: "gamme", type: "list-facet",
        facet_name: "byNestedGammes", multi_select: false, invert: false,
        nested: true, child: "object_type_s:contact",
        facetSort: "index", grid: "col-md-4",
        group: "marketing", icon_class: "fa-globe fa-2x"
    },
    {
        label: "Historique", field: ['enseigne', 'type', 'campagne'], type: "matrix-facet",
        facet_name: "byHisto", multi_select: false,
        facetSort: "count", grid: "col-md-4",
        group: "hist", icon_class: "fa-users fa-2x"
    },
    {
        label: "Chiffre", field: "ca_periode_i", type: "range-facet",
        facet_name: "byCA", multi_select: true, invert: false,
        facetSort: "count", grid: "col-md-4",
        group: "marketing", icon_class: "fa-eur fa-2x"
    }
];

// The sortable fields you want
const sortFields = [
    { label: "Departement", field: "code_departement_s" },
    { label: "Regroupement Type Parent", field: "type_parent_s" }
    //{label: "Date of birth", field: "birthDate_i"},
    //{label: "Date of death", field: "deathDate_i"}
];

document.addEventListener("DOMContentLoaded", () => {
    // The client class
    const current_query = eval("(" + document.getElementById("app").getAttribute('req') + ")");
    console.log("--%% " + current_query + " %%--")
    console.log("--%% " + document.getElementById("app").getAttribute('req') + " %%--")

    var solr_client = new SolrClient({
        // The solr index url to be queried by the client
        //url: "http://devsolr:8983/solr/edd_new/query",
        url: "http://dev-edd:8983/solr/edd_new/query",
        searchFields: fields,
        sortFields: sortFields,
        facetLimit: -1,

        // The change handler passes the current query- and result state for render
        // as well as the default handlers for interaction with the search component
        onChange: (state, handlers) =>
            // Render the faceted search component
            ReactDOM.render(
                <SolrFacetedSearch
                    {...state}
                    {...handlers}
                    bootstrapCss={true}
                    onSelectDoc={(doc) => console.log(doc)}
                />,
                document.getElementById("app")
            )
    });

    solr_client.setInitialQuery(current_query);

    solr_client.initialize(); // this will send an initial search, fetching all results from solr
});
